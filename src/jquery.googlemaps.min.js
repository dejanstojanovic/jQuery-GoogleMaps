/*
 * jQuery Plugin: JQuery GoogleMaps
 * https://github.com/dejanstojanovic/JQuery-GoogleMaps
 * Version 2.2.6
 *
 * Copyright (c) 2014 Dejan Stojanovic (http://dejanstojanovic.net)
 *
 * Released under the MIT license
 */
$.fn.GoogleMapEditor = function (options) { function addSearchBox(e) { var t = "q" + e.id; $(e.container).parent().prepend('<input id="' + t + '" style="margin-top:4px" type="text" placeholder="Search Box" />'); var o = document.getElementById(t); if (null != o) { e.controls[google.maps.ControlPosition.TOP_RIGHT].push(o); var n = new google.maps.places.SearchBox(o); google.maps.event.addListener(n, "places_changed", function () { for (var t, o = n.getPlaces(), a = new google.maps.LatLngBounds, i = 0; t = o[i]; i++) a.extend(t.geometry.location); e.fitBounds(a), e.setZoom(15) }), google.maps.event.addListener(e, "bounds_changed", function () { var t = e.getBounds(); n.setBounds(t) }) } } function addStylesList(map) { if (settings.editMode) { var selectId = "s" + map.id; $(map.container).parent().prepend('<select id="' + selectId + '" class="map-style" />'); var select = document.getElementById(selectId); $(select).append($("<option>", { value: JSON.stringify([]), text: "GoogleMaps Default" })), $.getJSON(settings.stylesPath, function (e) { $(e).each(function (e, t) { $(select).append($("<option>", { value: t.json, text: t.name })) }) }), null != select && (map.controls[google.maps.ControlPosition.TOP_LEFT].push(select), $(select).change(function () { map.setOptions({ mapTypeId: "Styled" }); var styledMapType = new google.maps.StyledMapType(eval($(this).val()), { name: "Styled" }); map.mapTypes.set("Styled", styledMapType), settings.style = eval($(this).val()), saveToJson(map) })) } } function addFitBoundsButton(e) { var t = "c" + e.id; $(e.container).parent().prepend('<input id="' + t + '" class="fit-bound" type="button" title="Fit bounds" />'); var o = document.getElementById(t); null != o && (e.controls[google.maps.ControlPosition.TOP_CENTER].push(o), $(o).click(function () { var t = getMapLocationsBounds(e); null != t && (e.fitBounds(t), saveToJson(e)) })) } function addPrintButton(e) { var t = "l" + e.id; $(e.container).parent().prepend('<input id="' + t + '" class="print-map" type="button" title="Print map" />'); var o = document.getElementById(t); null != o && (e.controls[google.maps.ControlPosition.TOP_CENTER].push(o), $(o).click(function () { e.setOptions({ mapTypeControl: !1, zoomControl: !1, streetViewControl: !1, panControl: !1 }); var t = function () { dataUrl = [], $(e.container).find("canvas").filter(function () { dataUrl.push(this.toDataURL("image/png")) }); var t = $(e.container), o = t.clone(), n = t.clientWidth, a = t.clientHeight; $(o).find("canvas").each(function (e, t) { $(t).replaceWith($("<img>").attr("src", dataUrl[e])).css("position", "absolute").css("left", "0").css("top", "0").css("width", n + "px").css("height", a + "px") }), $(o).find("input,select,.gmnoprint").hide(); var i = window.open("", "PrintMap", "width=" + n + ",height=" + a); i.document.writeln($(o).html()), i.document.close(), i.focus(), i.print(), i.close(), e.setOptions({ mapTypeControl: !0, zoomControl: settings.zoomControl, streetViewControl: settings.streetViewControl, panControl: settings.panControl }), $(o).find("input,.map-style,.gmnoprint").show() }; setTimeout(t, 500) })) } function addCurrentLocationButton(e) { var t = "l" + e.id; $(e.container).parent().prepend('<input id="' + t + '" class="current-location" type="button" title="My Location" />'); var o = document.getElementById(t); null != o && (e.controls[google.maps.ControlPosition.TOP_CENTER].push(o), $(o).click(function () { if (navigator.geolocation) { var t = $(e.container).next(); t.width($(e.container).width()), t.height($(e.container).height()), t.offset({ top: $(e.container).offset().top, left: $(e.container).offset().left }), t.fadeIn("slow"), navigator.geolocation.getCurrentPosition(function (o) { if (t.fadeOut("fast"), settings.editMode) { var n = new Location([new Coordinate(o.coords.latitude, o.coords.longitude)], google.maps.drawing.OverlayType.MARKER, "", "", "", "", "", ""); initMapObject(e, n), e.locations.push(n); var a = new google.maps.LatLngBounds(new google.maps.LatLng(n.Coordinates[0].Latitude, n.Coordinates[0].Longitude)); e.fitBounds(a), e.setZoom(15), new google.maps.event.trigger(n.Overlay, "click"), saveToJson(e) } else { var a = new google.maps.LatLngBounds(new google.maps.LatLng(o.coords.latitude, o.coords.longitude)); e.fitBounds(a), e.setZoom(15) } }, function (e) { alert("Unable to fetch your current location!\n" + e), t.fadeOut("fast") }) } })) } function arePopupTemplatesLoaded() { return null != popupTemplateCircle && null != popupTemplateRectangle && null != popupTemplateMarker && null != popupTemplatePolyline && null != popupTemplatePolygon ? !0 : !1 } function loadPopupTemplates() { $.ajax({ url: settings.editTemplatesPath + "popup-template-circle.html", method: "GET", dataType: "text html", success: function (e) { popupTemplateCircle = e } }), $.ajax({ url: settings.editTemplatesPath + "popup-template-rectangle.html", method: "GET", dataType: "text html", success: function (e) { popupTemplateRectangle = e } }), $.ajax({ url: settings.editTemplatesPath + "popup-template-marker.html", method: "GET", dataType: "text html", success: function (e) { popupTemplateMarker = e } }), $.ajax({ url: settings.editTemplatesPath + "popup-template-polyline.html", method: "GET", dataType: "text html", success: function (e) { popupTemplatePolyline = e } }), $.ajax({ url: settings.editTemplatesPath + "popup-template-polygon.html", method: "GET", dataType: "text html", success: function (e) { popupTemplatePolygon = e } }) } function initializeGoogleMapEditor(e) { var t = null; if (settings.editMode && loadPopupTemplates(), t = new google.maps.Map(e, { center: new google.maps.LatLng(settings.center.latitude, settings.center.longitude), zoom: settings.zoom, zoomControl: settings.zoomControl, panControl: settings.panControl, scaleControl: settings.scaleControl, streetViewControl: settings.streetViewControl, infoWindow: null, styles: settings.style }), t.setOptions({ scrollwheel: settings.scrollWheel }), t.container = e, t.locations = settings.locations.slice(0), t.id = createUUID(), $("<div/>", { "class": "map-overlay" }).append($("<input/>", { type: "button", value: "Close", "class": "btn-close" })).insertAfter($(t.container)), $(".map-overlay input.btn-close").click(function () { $(this).parent().fadeOut("slow") }), google.maps.event.addListenerOnce(t, "idle", function () { if (addStylesList(t), addFitBoundsButton(t), addCurrentLocationButton(t), addPrintButton(t), settings.searchBox && addSearchBox(t), null != t.locations && t.locations.length > 0) for (i = 0; i < t.locations.length; i++) initMapObject(t, t.locations[i]); saveToJson(t) }), google.maps.event.addListenerOnce(t, "center_changed", function () { saveToJson(t) }), google.maps.event.addListenerOnce(t, "zoom_changed", function () { saveToJson(t) }), google.maps.event.addListenerOnce(t, "maptypeid_changed", function () { saveToJson(t) }), google.maps.event.addListenerOnce(t, "dragend", function () { saveToJson(t) }), google.maps.event.addListener(t, "click", function () { for (null != t.infoWindow && (t.infoWindow.close(), t.activeLocation = null), i = 0; i < t.locations.length; i++) t.locations[i].Overlay.set("editable", !1) }), settings.editMode) { var o = new google.maps.drawing.DrawingManager({ drawingMode: google.maps.drawing.OverlayType.MARKER, drawingControl: !0, polygonOptions: { draggable: settings.editMode, strokeWeight: settings.drawingBorderWidth, strokeColor: settings.drawingBorderColor, fillColor: settings.drawingFillColor }, markerOptions: { draggable: settings.editMode }, polylineOptions: { draggable: settings.editMode, strokeWeight: settings.drawingBorderWidth, strokeColor: settings.drawingBorderColor, fillColor: settings.drawingFillColor }, circleOptions: { draggable: settings.editMode, strokeWeight: settings.drawingBorderWidth, strokeColor: settings.drawingBorderColor, fillColor: settings.drawingFillColor }, rectangleOptions: { draggable: settings.editMode, strokeWeight: settings.drawingBorderWidth, strokeColor: settings.drawingBorderColor, fillColor: settings.drawingFillColor }, drawingControlOptions: { position: google.maps.ControlPosition.TOP_CENTER, drawingModes: settings.drawingTools } }); google.maps.event.addListener(o, "overlaycomplete", function (e) { var o = null; settings.singleLocation && clearLocations(t), e.overlay.set("draggable", settings.editMode), o = initLocationObject(t, e.overlay, e.type), attachLocationHandlers(t, o, e.type), e.overlay.setOptions({ suppressUndo: !0 }), attachTransformHandlers(t, e.overlay, e.type), null != settings.locationNew && "function" == typeof settings.locationNew && settings.locationNew(t, o) }), o.setMap(t) } } function attachTransformHandlers(e, t, o) { switch (o) { case google.maps.drawing.OverlayType.POLYLINE: case google.maps.drawing.OverlayType.POLYGON: google.maps.event.addListener(t.getPath(), "set_at", function () { updateLocationObject(e, t.Location, o, !0) }), google.maps.event.addListener(t.getPath(), "insert_at", function () { updateLocationObject(e, t.Location, o, !0) }), google.maps.event.addListener(t.getPath(), "remove_at", function () { updateLocationObject(e, t.Location, o, !0) }); break; case google.maps.drawing.OverlayType.CIRCLE: google.maps.event.addListener(t, "radius_changed", function () { updateLocationObject(e, t.Location, o, !0) }), google.maps.event.addListener(t, "center_changed", function () { updateLocationObject(e, t.Location, o, !0) }); break; case google.maps.drawing.OverlayType.RECTANGLE: google.maps.event.addListener(t, "bounds_changed", function () { updateLocationObject(e, t.Location, o, !0) }) } } function clearLocations(e) { if (null != e.locations && e.locations.length > 0) { for (i = 0; i < e.locations.length; i++) e.locations[i].Overlay.setMap(null); e.locations.length = 0, e.locations = [] } } function initLocationObject(e, t, o) { var n, a = []; switch (o) { case google.maps.drawing.OverlayType.MARKER: n = new Location([new Coordinate(t.getPosition().lat(), t.getPosition().lng())], google.maps.drawing.OverlayType.MARKER, "", "", "", "", "", ""); break; case google.maps.drawing.OverlayType.CIRCLE: n = new Location([new Coordinate(t.getCenter().lat(), t.getCenter().lng())], google.maps.drawing.OverlayType.CIRCLE, ""), n.Radius = t.getRadius(); break; case google.maps.drawing.OverlayType.POLYLINE: for (i = 0; i < t.getPath().length; i++) a.push(new Coordinate(t.getPath().getAt(i).lat(), t.getPath().getAt(i).lng())); n = new Location(a, google.maps.drawing.OverlayType.POLYLINE, ""); break; case google.maps.drawing.OverlayType.POLYGON: for (i = 0; i < t.getPath().length; i++) a.push(new Coordinate(t.getPath().getAt(i).lat(), t.getPath().getAt(i).lng())); n = new Location(a, google.maps.drawing.OverlayType.POLYGON, ""); break; case google.maps.drawing.OverlayType.RECTANGLE: a.push(new Coordinate(t.getBounds().getNorthEast().lat(), t.getBounds().getNorthEast().lng())), a.push(new Coordinate(t.getBounds().getSouthWest().lat(), t.getBounds().getSouthWest().lng())), n = new Location(a, google.maps.drawing.OverlayType.RECTANGLE, "") } return n.Overlay = t, t.Location = n, null == e.locations && (e.locations = []), e.locations.push(n), saveToJson(e), n } function initMapObject(e, t) { switch (t.LocationType) { case google.maps.drawing.OverlayType.MARKER: var o = new google.maps.Marker({ draggable: settings.editMode, map: e, position: new google.maps.LatLng(t.Coordinates[0].Latitude, t.Coordinates[0].Longitude), Location: t }); null != t.Icon && "" != t.Icon && o.setIcon(new google.maps.MarkerImage(settings.markerPinsPath + t.Icon)), t.Overlay = o, attachLocationHandlers(e, t, google.maps.drawing.OverlayType.MARKER); break; case google.maps.drawing.OverlayType.CIRCLE: var n = new google.maps.Circle({ draggable: settings.editMode, map: e, strokeWeight: t.BorderWeight, strokeColor: t.BorderColor, fillColor: t.FillColor, map: e, radius: t.Radius, center: new google.maps.LatLng(t.Coordinates[0].Latitude, t.Coordinates[0].Longitude), Location: t }); t.Overlay = n, attachLocationHandlers(e, t, google.maps.drawing.OverlayType.CIRCLE); break; case google.maps.drawing.OverlayType.POLYLINE: var a = []; for (c = 0; c < t.Coordinates.length; c++) { var i = new google.maps.LatLng(t.Coordinates[c].Latitude, t.Coordinates[c].Longitude); a.push(i) } polyline = new google.maps.Polyline({ path: a, strokeWeight: t.BorderWeight, strokeColor: t.BorderColor, draggable: settings.editMode, Location: t }), polyline.setMap(e), t.Overlay = polyline, attachLocationHandlers(e, t, google.maps.drawing.OverlayType.POLYLINE); break; case google.maps.drawing.OverlayType.POLYGON: var l = []; for (c = 0; c < t.Coordinates.length; c++) { var r = new google.maps.LatLng(t.Coordinates[c].Latitude, t.Coordinates[c].Longitude); l.push(r) } polygon = new google.maps.Polygon({ path: l, strokeWeight: t.BorderWeight, strokeColor: t.BorderColor, fillColor: t.FillColor, draggable: settings.editMode, Location: t }), polygon.setMap(e), t.Overlay = polygon, attachLocationHandlers(e, t, google.maps.drawing.OverlayType.POLYGON); break; case google.maps.drawing.OverlayType.RECTANGLE: var s = new google.maps.Rectangle({ draggable: settings.editMode, map: e, strokeWeight: t.BorderWeight, strokeColor: t.BorderColor, fillColor: t.FillColor, map: e, bounds: new google.maps.LatLngBounds(new google.maps.LatLng(t.Coordinates[1].Latitude, t.Coordinates[1].Longitude), new google.maps.LatLng(t.Coordinates[0].Latitude, t.Coordinates[0].Longitude)), Location: t }); t.Overlay = s, attachLocationHandlers(e, t, google.maps.drawing.OverlayType.RECTANGLE) } attachTransformHandlers(e, t.Overlay, t.LocationType) } function saveToJson(e) { var t = null; if (settings.editMode) { var o = getMapLocationsBounds(e); if (null != o) { var n = getMapLocationsBounds(e).getCenter(); settings.center = new Coordinate(n.lat(), n.lng()) } var a = ["editMode", "editTemplatesPath", "markerPinsPath", "markerPinFiles", "drawingBorderColor", "drawingBorderWidth", "drawingFillColor", "zoom", "width", "height", "singleLocation", "center", "language", "searchBox", "richtextEditor", "drawingTools", "zoomControl", "panControl", "scaleControl", "streetViewControl", "scrollWheel", "stylesPath", "style", "locations"]; a = a.concat(["latitude", "longitude", "Coordinates", "Latitude", "Longitude", "Radius", "LocationType", "Icon", "HoverIcon", "Message", "BorderColor", "BorderWeight", "FillColor", "Tag"]), a = a.concat(["featureType", "elementType", "stylers", "color", "hue", "weight", "visibility", "lightness", "saturation"]), t = JSON.stringify($.extend({}, settings, { locations: e.locations }), a), null != settings.dataChange && "function" == typeof settings.dataChange && settings.dataChange(e, t) } return t } function handleMapCloseClick(e, t) { "undefined" != typeof e.activeLocation && null != e.activeLocation && $(".color-picker").remove(), updateLocationObject(e, e.activeLocation, t, !1) } function attachLocationHandlers(e, t, o) { google.maps.event.addListener(t.Overlay, "dragend", function () { updateLocationObject(e, this.Location, o, !0), null != settings.locationMove && "function" == typeof settings.locationMove && settings.locationMove(e, t) }), google.maps.event.addListener(t.Overlay, "mouseover", function () { o == google.maps.drawing.OverlayType.MARKER && t.HoverIcon && "none" != t.HoverIcon && null != t.HoverIcon && "" != t.HoverIcon && t.Overlay.setIcon(settings.markerPinsPath + t.HoverIcon) }), google.maps.event.addListener(t.Overlay, "mouseout", function () { o == google.maps.drawing.OverlayType.MARKER && t.Overlay.setIcon("default" != t.Icon && null != t.Icon && "" != t.Icon ? settings.markerPinsPath + t.Icon : null) }), google.maps.event.addListener(t.Overlay, "click", function () { if (arePopupTemplatesLoaded() || !settings.editMode) { for (null != e.infoWindow && (e.infoWindow.close(), e.activeLocation = null), i = 0; i < e.locations.length; i++) e.locations[i].Overlay.set("editable", !1); t.Overlay.set("editable", settings.editMode), e.infoWindow = new google.maps.InfoWindow, e.activeLocation = t, google.maps.event.addListener(e.infoWindow, "closeclick", function () { handleMapCloseClick(e, o) }); var n = null, a = null; switch (o) { case google.maps.drawing.OverlayType.MARKER: n = t.Overlay.position, a = $("<div>").append(popupTemplateMarker), settings.richtextEditor || a.find("textarea").removeClass("richtext-fix"); break; case google.maps.drawing.OverlayType.CIRCLE: n = t.Overlay.getCenter(), a = $("<div>").append(popupTemplateCircle), settings.richtextEditor || a.find("textarea").removeClass("richtext-fix"); break; case google.maps.drawing.OverlayType.POLYLINE: n = getPolyLineCenter(t.Overlay), a = $("<div>").append(popupTemplatePolyline), settings.richtextEditor || a.find("textarea").removeClass("richtext-fix"); break; case google.maps.drawing.OverlayType.POLYGON: n = getPolygonCenter(t.Overlay), a = $("<div>").append(popupTemplatePolygon), settings.richtextEditor || a.find("textarea").removeClass("richtext-fix"); break; case google.maps.drawing.OverlayType.RECTANGLE: n = t.Overlay.getBounds().getCenter(), a = $("<div>").append(popupTemplateRectangle), settings.richtextEditor || a.find("textarea").removeClass("richtext-fix") } e.infoWindow.setContent(null != a && settings.editMode ? a.html() : $("<div/>").append($("<div/>", { "class": "popup-message" }).html(t.Message)).html()), google.maps.event.addListener(e.infoWindow, "domready", function () { $(e.container).find(".popup-content textarea").val(e.activeLocation.Message), $(e.container).find('.popup-content input[name="locationLat"]').val(n.lat()), $(e.container).find('.popup-content input[name="locationLng"]').val(n.lng()), $(e.container).find('.popup-content input[name="centerLat"]').val(n.lat()), $(e.container).find('.popup-content input[name="centerLng"]').val(n.lng()), $(e.container).find('.popup-content input[name="borderWidth"]').val(t.BorderWeight), $(e.container).find('.popup-content input[name="radius"]').val(t.Radius); var o = $(e.container).find('.popup-content select[name="icon"]'); if (o.length > 0 && settings.markerPinFiles.length > 0) { for (i = 0; i < settings.markerPinFiles.length; i++) o.append($("<option>", { value: settings.markerPinsPath + settings.markerPinFiles[i], text: settings.markerPinFiles[i] })); o.find("option").each(function () { $(this).text() == t.Icon && $(this).prop("selected", !0) }) } else o.parent().parent().remove(); var a = $(e.container).find('.popup-content select[name="hover-icon"]'); if (a.length > 0 && settings.markerPinFiles.length > 0) { for (i = 0; i < settings.markerPinFiles.length; i++) a.append($("<option>", { value: settings.markerPinsPath + settings.markerPinFiles[i], text: settings.markerPinFiles[i] })); a.find("option").each(function () { $(this).text() == t.HoverIcon && $(this).prop("selected", !0) }) } else a.parent().parent().remove(); var l = $(e.container).find('.popup-content input[name="strokeColor"]'), r = $(e.container).find('.popup-content input[name="fillColor"]'), s = $(e.container).find('.popup-content input[name="strokeColorPicker"]'), c = $(e.container).find('.popup-content input[name="fillColorPicker"]'); l.val(e.activeLocation.BorderColor), s.val(e.activeLocation.BorderColor), s.height(l.outerHeight()), s.width(l.outerHeight()), r.val(e.activeLocation.FillColor), c.val(e.activeLocation.FillColor), c.height(r.outerHeight()), c.width(r.outerHeight()), isIE() ? (l.simpleColorPicker(), r.simpleColorPicker()) : (c.change(function () { r.val($(this).val()) }), r.change(function () { c.val($(this).val()) }), s.change(function () { l.val($(this).val()) }), l.change(function () { s.val($(this).val()) })), settings.richtextEditor && intTinyMce(), initPopupButtons(e) }), null != n && o != google.maps.drawing.OverlayType.MARKER ? (e.infoWindow.setPosition(n), e.infoWindow.open(e)) : e.infoWindow.open(e, t.Overlay), null != settings.locationClick && "function" == typeof settings.locationClick && settings.locationClick(e, t) } }) } function updateLocationObject(e, t, o, n) { var a = []; switch ($(".popup-content").length > 0 && ("undefined" != typeof tinymce && tinyMCE.triggerSave(), t.Message = $(e.container).find(".popup-content textarea").val(), t.BorderColor = $('.popup-content input[name="strokeColor"]').val(), t.FillColor = $('.popup-content input[name="fillColor"]').val(), t.BorderWeight = $('.popup-content input[name="borderWidth"]').val(), o != google.maps.drawing.OverlayType.MARKER && (t.Overlay.setOptions({ strokeColor: t.BorderColor, strokeWeight: t.BorderWeight }), o != google.maps.drawing.OverlayType.POLYLINE && t.Overlay.setOptions({ fillColor: t.FillColor }))), o) { case google.maps.drawing.OverlayType.MARKER: if (t.Coordinates.length = 0, t.Coordinates.push(new Coordinate(t.Overlay.getPosition().lat(), t.Overlay.getPosition().lng())), $('select[name="icon"]').length > 0) { var l = $('select[name="icon"] :selected').text(); "default" == l ? (t.Icon = null, t.Overlay.setIcon(null)) : (t.Icon = l, t.Overlay.setIcon(settings.markerPinsPath + t.Icon)); var r = $('select[name="hover-icon"] :selected').text(); t.HoverIcon = "none" == l ? null : r, t.Coordinates[0].Latitude = parseFloat($('.popup-content input[name="locationLat"]').val()), t.Coordinates[0].Longitude = parseFloat($('.popup-content input[name="locationLng"]').val()), t.Overlay.setPosition(new google.maps.LatLng(t.Coordinates[0].Latitude, t.Coordinates[0].Longitude)) } break; case google.maps.drawing.OverlayType.CIRCLE: $('.popup-content input[name="radius"]').length > 0 ? (t.Radius = parseFloat($('.popup-content input[name="radius"]').val()), google.maps.event.clearListeners(t.Overlay, "radius_changed"), t.Overlay.setRadius(t.Radius), google.maps.event.addListener(t.Overlay, "radius_changed", function () { updateLocationObject(e, t, o, !0) })) : t.Radius = t.Overlay.getRadius(), $('.popup-content input[name="centerLat"]').length > 0 && $('.popup-content input[name="centerLng"]').length > 0 ? (google.maps.event.clearListeners(t.Overlay, "center_changed"), t.Overlay.setCenter(new google.maps.LatLng(parseFloat($('.popup-content input[name="centerLat"]').val()), parseFloat($('.popup-content input[name="centerLng"]').val()))), google.maps.event.addListener(t.Overlay, "center_changed", function () { updateLocationObject(e, t, o, !0) }), t.Coordinates.length = 0, t.Coordinates.push(new Coordinate(t.Overlay.getCenter().lat(), t.Overlay.getCenter().lng()))) : (t.Coordinates.length = 0, t.Coordinates.push(new Coordinate(t.Overlay.getCenter().lat(), t.Overlay.getCenter().lng()))); break; case google.maps.drawing.OverlayType.POLYLINE: for (i = 0; i < t.Overlay.getPath().length; i++) a.push(new Coordinate(t.Overlay.getPath().getAt(i).lat(), t.Overlay.getPath().getAt(i).lng())); t.Coordinates = a; break; case google.maps.drawing.OverlayType.POLYGON: for (i = 0; i < t.Overlay.getPath().length; i++) a.push(new Coordinate(t.Overlay.getPath().getAt(i).lat(), t.Overlay.getPath().getAt(i).lng())); t.Coordinates = a; break; case google.maps.drawing.OverlayType.RECTANGLE: a.push(new Coordinate(t.Overlay.getBounds().getNorthEast().lat(), t.Overlay.getBounds().getNorthEast().lng())), a.push(new Coordinate(t.Overlay.getBounds().getSouthWest().lat(), t.Overlay.getBounds().getSouthWest().lng())), t.Coordinates = a } null != e.activeLocation && n && null != e.infoWindow && e.infoWindow.close(), saveToJson(e) } function initPopupButtons(e) { var t = $(e.container).find(".btn-popup-delete"); t.off("click"), t.click(function () { confirm("Delete this location?") && (e.activeLocation.Overlay.setMap(null), e.locations.splice(e.locations.indexOf(e.activeLocation), 1), e.activeLocation = null, saveToJson(e), e.infoWindow.close(), null != settings.locationDelete && "function" == typeof settings.locationDelete && settings.locationDelete(e, location)) }); var o = $(e.container).find(".btn-popup-cancel"); o.off("click"), o.click(function () { "true" === $('.popup-content [name="changed"]').val() ? confirm("Cancel changes?") && e.infoWindow.close() : e.infoWindow.close() }); var n = $(e.container).find(".btn-popup-save"); n.off("click"), n.click(function () { handleMapCloseClick(e, e.activeLocation.LocationType), e.infoWindow.close() }), $('.popup-content input[type="text"],.popup-content input[type="number"],.popup-content input[type="color"],.popup-content select,.popup-content textarea').change(function () { $('.popup-content input[name="changed"]').val(!0) }) } function isIE() { var e = window.navigator.userAgent, t = e.indexOf("MSIE "); return t > 0 || navigator.userAgent.match(/Trident.*rv\:11\./) ? !0 : !1 } function intTinyMce() { "undefined" == typeof tinymce ? $.getScript(tinyMceUrl, function () { tinymce.init({ selector: ".popup-content textarea", plugins: ["code image link media table textcolor"], resize: !1, toolbar: "bold italic | forecolor | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link | code", menubar: !1, statusbar: !1 }) }) : tinymce.init({ selector: ".popup-content textarea", plugins: ["code image link media table textcolor"], resize: !1, toolbar: "bold italic | forecolor | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link | code", menubar: !1, statusbar: !1 }) } function getMapLocationsBounds(e) { if (null != e.locations && e.locations.length > 0) { var t = new google.maps.LatLngBounds; for (i = 0; i < e.locations.length; i++) for (j = 0; j < e.locations[i].Coordinates.length; j++) t.extend(new google.maps.LatLng(e.locations[i].Coordinates[j].Latitude, e.locations[i].Coordinates[j].Longitude)); return t } return null } function getPolyLineCenter(e) { var t = parseInt(e.getPath().getLength() / 2); return new google.maps.LatLng(e.getPath().getAt(t).lat(), e.getPath().getAt(t).lng()) } function getPolygonCenter(e) { var t = new google.maps.LatLngBounds; for (i = 0; i < e.getPath().getLength() ; i++) t.extend(new google.maps.LatLng(e.getPath().getAt(i).lat(), e.getPath().getAt(i).lng())); return t.getCenter() } function createUUID() { for (var e = [], t = "0123456789abcdef", o = 0; 36 > o; o++) e[o] = t.substr(Math.floor(16 * Math.random()), 1); e[14] = "4", e[19] = t.substr(3 & e[19] | 8, 1), e[8] = e[13] = e[18] = e[23] = ""; var n = e.join(""); return n } function htmlEncode(e) { return $("<div/>").text(e).html() } function htmlDecode(e) { return $("<div/>").html(e).text() } function Location(e, t, o) { this.Coordinates = e, this.LocationType = t, this.Icon = null, this.Message = o, this.Overlay = null, this.Radius = 0, this.BorderColor = settings.drawingBorderColor, this.BorderWeight = settings.drawingBorderWidth, this.FillColor = settings.drawingFillColor, this.Tag = null } function Coordinate(e, t) { this.Latitude = e, this.Longitude = t } var defaults = { editMode: !0, editTemplatesPath: "../src/html/", markerPinsPath: "../src/img/pin/", markerPinFiles: ["flag-azure.png", "flag-green.png", "needle-pink.png", "niddle-green.png", "pin-azure.png", "pin-green.png", "pin-pink.png"], drawingBorderColor: "#ff0000", drawingBorderWidth: 2, drawingFillColor: "#ffff00", zoom: 13, center: { latitude: 25.0417, longitude: 55.2194 }, width: 800, height: 400, language: "en", singleLocation: !1, searchBox: !0, richtextEditor: !0, drawingTools: ["marker", "polyline", "polygon", "circle", "rectangle"], zoomControl: !0, panControl: !0, scaleControl: !0, streetViewControl: !0, scrollWheel: !1, style: null, stylesPath: "../src/styles.json", locations: [], dataChange: null, locationClick: null, locationNew: null, locationDelete: null, locationMove: null }, settings = $.extend({}, defaults, options), tinyMceUrl = "//tinymce.cachefly.net/4.0/tinymce.min.js", mapApiUrl = "//maps.googleapis.com/maps/api/js?sensor=false&callback=mapApiLoaded&libraries=drawing,places"; "" != settings.language && (mapApiUrl += "&language=" + settings.language); var popupTemplateCircle = null, popupTemplateRectangle = null, popupTemplateMarker = null, popupTemplatePolyline = null, popupTemplatePolygon = null, selector = $(this); null == ("undefined" != typeof google && null !== google ? google.maps : void 0) ? ($.getScript(mapApiUrl), window.mapApiLoaded = function () { selector.each(function (e) { var t = selector.get(e); settings.width == defaults.width ? $(t).width() <= 0 && $(t).width(defaults.width) : $(t).width(settings.width), settings.height == defaults.height ? $(t).height() <= 0 && $(t).height(defaults.height) : $(t).height(settings.height), initializeGoogleMapEditor(t) }) }) : selector.each(function (e) { var t = selector.get(e); initializeGoogleMapEditor(t) }) }, $.fn.simpleColorPicker = function (e) { var t = { colorsPerLine: 8, colors: ["#000000", "#444444", "#666666", "#999999", "#cccccc", "#eeeeee", "#f3f3f3", "#ffffff", "#ff0000", "#ff9900", "#ffff00", "#00ff00", "#00ffff", "#0000ff", "#9900ff", "#ff00ff", "#f4cccc", "#fce5cd", "#fff2cc", "#d9ead3", "#d0e0e3", "#cfe2f3", "#d9d2e9", "#ead1dc", "#ea9999", "#f9cb9c", "#ffe599", "#b6d7a8", "#a2c4c9", "#9fc5e8", "#b4a7d6", "#d5a6bd", "#e06666", "#f6b26b", "#ffd966", "#93c47d", "#76a5af", "#6fa8dc", "#8e7cc3", "#c27ba0", "#cc0000", "#e69138", "#f1c232", "#6aa84f", "#45818e", "#3d85c6", "#674ea7", "#a64d79", "#990000", "#b45f06", "#bf9000", "#38761d", "#134f5c", "#0b5394", "#351c75", "#741b47", "#660000", "#783f04", "#7f6000", "#274e13", "#0c343d", "#073763", "#20124d", "#4C1130"], showEffect: "", hideEffect: "", onChangeColor: !1 }, o = $.extend(t, e); return this.each(function () { function e(e) { "fade" == o.hideEffect ? e.fadeOut() : "slide" == o.hideEffect ? e.slideUp() : e.hide() } function n(e) { "fade" == o.showEffect ? e.fadeIn() : "slide" == o.showEffect ? e.slideDown() : e.show() } for (var a = $(this), i = "", l = a.attr("id").replace(/-/g, "") + "_", r = 0; r < o.colors.length; r++) { var s = o.colors[r], c = ""; r % o.colorsPerLine == 0 && (c = "clear: both; "), r > 0 && c && $.browser && $.browser.msie && $.browser.version <= 7 && (c = "", i += '<li style="float: none; clear: both; overflow: hidden; background-color: #fff; display: block; height: 1px; line-height: 1px; font-size: 1px; margin-bottom: -2px;"></li>'), i += '<li id="' + l + "color-" + r + '" class="color-box" style="' + c + "background-color: " + s + '" title="' + s + '"></li>' } var g = $('<div id="' + l + 'color-picker" class="color-picker" style="position: absolute; left: 0px; top: 0px;"><ul>' + i + '</ul><div style="clear: both;"></div></div>'); $("body").append(g), g.hide(), g.find("li.color-box").click(function () { a.is("input") && (a.val(o.colors[this.id.substr(this.id.indexOf("-") + 1)]), a.blur()), $.isFunction(t.onChangeColor) && t.onChangeColor.call(a, o.colors[this.id.substr(this.id.indexOf("-") + 1)]), e(g) }), $(document).on("click", "body", function () { e(g) }), g.click(function (e) { e.stopPropagation() }); var p = function (e) { var t = a.offset(), o = t.left + a.outerWidth() - e.outerWidth(); o < t.left && (o = t.left), e.css({ left: o, top: t.top + a.outerHeight() }), n(e) }; a.click(function (e) { e.stopPropagation(), a.is("input") || p(g) }), a.focus(function () { $(".color-picker").each(function () { e($(this)) }), p(g) }) }) };
